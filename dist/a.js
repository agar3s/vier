!function(){function getTotalDamage(e,n,t){return afalMatriz[e][n]*t/2}function createParticles(e,n,t,r,a){for(var i=0;i<e.D.length;i++){var o=15&e.D[i];particles.push(new Particle(e.x+(e.aa?o:15-o)*e.e,e.y+(e.D[i]>>4)*e.e,((e.aa?o:15-o)-8)*n+t,((e.D[i]>>4)-8)*n+r-2,e.e,a))}}function gameLoop(){ctx.clearRect(-viewport.x,viewport.y,dimensions.w,dimensions.h),xlevel.ag(),firexx.ag(),heroS.ag(),heroS.b(.8),xlevel.v(heroS),myhero.d();for(var n=ans.length-1;n>=0;n--)ans[n].d(),ans[n].S.ag(),loop%4==0&&ans[n].ah(),loop%2==0&&ans[n].v(),(ans[n].ai||ans[n].del)&&ans.splice(n,1);for(var n=enemies.length-1;n>=0;n--){var t=enemies[n];t.del?enemies.splice(n,1):(t.S.ag(),t.S.b(.8),xlevel.v(t.S),t.d(),loop%2==0&&t.S.ah())}for(var r=particles.length-1;r>=0;r--)particles[r].ag(),particles[r].d()&&particles.splice(r,1);loop%8==0&&firexx.u(),loop%64==0&&(loop=0),firexx.c(),loop%2==0&&heroS.ah(),myhero.S.x>450+viewport.x&&myhero.S.x<xlevel.w-dimensions.w+450?(viewport.x-=myhero.S.vx,xxx=-myhero.S.vx):xxx=0,yyy=0,viewport.y-viewport.oY<-dimensions.h&&myhero.S.y+viewport.oY+16*e>viewport.y+dimensions.h&&myhero.S.vy>0?yyy=-myhero.S.vy:myhero.S.y-viewport.oY<viewport.y&&(myhero.S.vy<0?yyy=-myhero.S.vy:0==myhero.S.vy&&(yyy=yOld-myhero.S.y)),viewport.y-=yyy,yOld=myhero.S.y,ctx.translate(xxx,yyy),myhero.aj(),myhero.ag(),loop++,ra(gameLoop)}var doc=document;doc.get=doc.getElementById;var i,j,canvas=doc.get("c"),ctx=canvas.getContext("2d"),e=4,ppp=16,pp1=15,dimensions={w:1024,h:720},viewport={x:0,y:-720,oY:250},zoomFactor=(innerHeight-100)/dimensions.h;canvas.width=dimensions.w*zoomFactor,canvas.height=dimensions.h*zoomFactor,ctx.scale(zoomFactor,zoomFactor),ctx.translate(viewport.x,-viewport.y);var ans=[],afColors=[295,205,25,115],basicColors=["#E0F","#09F","#F60","#1F0"],enemies=[],particles=[],platforms=[],currentEnemy=null;ctx.font="normal lighter 18px fantasy";for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];requestAnimationFrame||(requestAnimationFrame=function(e){var n=(new Date).getTime(),t=Math.max(0,16-(n-lastTime)),r=setTimeout(function(){e(n+t)},t);return lastTime=n+t,r}),ra=requestAnimationFrame;var keyMap=0,keys={37:1,38:2,39:4,40:8,65:16,83:32,68:64,32:128};doc.addEventListener("keydown",function(e){var n=e.keyCode?e.keyCode:e.which;keys[n]&&(keyMap|=keys[n],e.preventDefault())}),doc.addEventListener("keyup",function(e){var n=e.keyCode?e.keyCode:e.which;keyMap&keys[n]&&(keyMap^=keys[n],e.preventDefault())});var afalMatriz=[[0,4,1,2],[1,0,2,4],[4,2,0,1],[2,1,4,0]],ElementalSkill=function(e,n){var t=this;t.afs=e,t.charges=[],t.current=t.afs[0],t.currentQ=n;for(var r=0;r<e.length;r++)t.charges.push(n);t.an=function(e){if(t.charges[t.current]-->0){var n=new Power(t.current,2);n.S.vy=e,ans.push(n),t.dCurrentQ()}else t.charges[t.current]=0,t.dCurrentQ()},t.dCurrentQ=function(){t.currentQ=t.charges[t.current]},t.ag=function(e,n){for(var r=0;4>r;r++)ctx.fillStyle=r==t.current&&loop%8==0?"#000":basicColors[r],ctx.fillText(""+t.charges[r],e+30+(r%2==0?35:1==r?69:0),n-35-(r%2==1?30:0==r?60:0));firexx.x=e+50,firexx.y=n-95,firexx.ag()}},Particle=function(e,n,t,r,a,i){var o=this;o.x=e,o.y=n,o.vx=t,o.vy=r,o.size=a,o.ac=i,o.life=100,o.d=function(){return o.x+=o.vx,o.vy+=.2,o.y+=o.vy,o.size*=1,--o.life<0},o.ag=function(){ctx.fillStyle="hsla("+o.ac+","+o.life+"%, "+o.life+"%, "+o.life/100+")",ctx.fillRect(o.x,o.y,o.size,o.size)}},fire="{f{g{h{i{u!$%056?@ABFORV`bcefostu~,",hero='{H{I{X{Y"#$134ACEQSVacdsu~.~1~=~@~M~P~]~^~`~a',heroan='{I{J{Y{Z"#$134ACERSVcdsu~.~0~=~?~M~O~]~^~_~`',herorun='{Y{Z{i{j"#$134ACDESVWbcdqru~)~*~+~0~9~A~Q~a~b',heroak="{Z{[{g{h{i{j{k!#$134ACESTcesu~-~0~=~?~L~O~\\~_",ab=["",'~A~>~0tqfUD2{i{h~@~=~1udVE1$#"{I{H',"B65VREA","~@~>tD2('&%{m{j{i~?~=udB651\"{J{I","~_~P~O~J~;~:~,tUB~b~a~Q~9~+~*~)uqWEA",'~`~M~?~>~=~/T2{k{[~P~J~A~;~:~0~,rdbVB1"{i{Y'],animations={i:{kf:hero,f:[0,0,0,0,0,0,0,0,0,1]},p:{kf:heroan,f:[2,3,3,2,0,-1]},r:{kf:herorun,f:[0,4,0,5,0,5,0,4,0]},j:{kf:heroak,f:[0]}},convertTobyte=function(e){for(var n=new Int16Array(ppp),t=0;t<e.length;t++)n[e[t]>>4]|=1<<pp1-(15&e[t]);return n},Sprite=function(n){var t=this;t.w=new Int16Array(ppp),t.D=n,t.ab=[],t.ad=0,t.ac="#000",t.x=0,t.y=-720,t.vx=0,t.vy=0,t.aa=1,t.p=0,t.w=convertTobyte(t.D),t.maxVx=2.2*e,t.n=.25,t.e=0,t.hp=1,t.setPixelSize=function(e){t.e=e,t.height=t.width=16*t.e},t.setPixelSize(e),t.u=function(){for(var e=[],n=0;ppp>n;n++)for(var r=0;ppp>r;r++)t.w[n]&1<<pp1-r&&e.push(r*ppp+pp1-n);t.D=e,t.w=convertTobyte(e)},t.addFrame=function(e){t.ab.push(convertTobyte(e)),t.ad=t.ab.length-1},t.fall=function(){t.y+=t.vy,t.vy<0&&(t.p=0)},t.ah=function(){if(++t.ad>=t.ab.length&&(t.ad=0),"string"==typeof t.ab[t.ad])return t.o(t.ab[t.ad]);for(var e=[],n=0;ppp>n;n++){t.w[n]=t.w[n]^t.ab[t.ad][n];for(var r=0;ppp>r;r++)1<<pp1-r&t.w[n]&&e.push(n*ppp+r)}t.D=e},t.xi=function(){return t.x+5*t.e},t.xpi=function(){return t.x+t.e},t.xf=function(){return t.x+11*t.e},t.xpf=function(){return t.x+14*t.e},t.yi=function(){return t.y+2*t.e},t.yil=function(){return t.y+12*t.e},t.yf=function(){return t.y+16*t.e},t.b=function(e){t.vy+=e,t.vy>3*t.e&&(t.vy=3*t.e)},t.land=function(e){t.p||t.o("i"),t.vy=0,t.p=1,t.z=1,t.downed=0,t.y=e-15*t.e},t.l=function(){t.vx>0&&(t.vx=0),t.vx-=t.n,t.p&&t.o("r"),t.vx<-t.maxVx&&(t.vx=-t.maxVx),t.aa=0},t.h=function(){t.vx<0&&(t.vx=0),t.vx+=t.n,t.p&&t.o("r"),t.vx>t.maxVx&&(t.vx=t.maxVx),t.aa=1},t.forward=function(){t.aa?t.h():t.l()},t.turn=function(){t.aa=!t.aa},t.g=function(){0!=t.vx&&(t.vx=0,t.o("i"))},t.ak=function(){(t.p||t.z)&&(t.vy=3*-t.e,t.p||(t.z=0),t.p=0,t.o("j"))},t.d=function(){t.fall(),t.x+=t.vx},t.c=function(){t.x+=t.vx},t.dY=function(){t.y+=t.vy},t.ag=function(){ctx.fillStyle=t.ac;for(var e=0;e<t.D.length;e++){var n=15&t.D[e];ctx.fillRect(t.x+(t.aa?n:15-n)*t.e,t.y+(t.D[e]>>4)*t.e,t.e,t.e)}},t.o=function(e){if(t.t!=e){t.t=e,t.ab=[];var n=animations[e].f;for(t.w=convertTobyte(loadByString(animations[e].kf)),j=0;j<n.length;j++){var r=ab[n[j]];if(-1==n[j])return t.ad=t.ab.length,t.ab.push("i");t.addFrame(loadByString(r))}}},t.hit=function(e){return t.hp-=e,t.hp<0&&(t.hp=0),0==t.hp}},loadByString=function(e){for(var n=0,t=e[n],r=[];t;){var a=85;"{"==t[0]&&(t=e[++n],a=0),"~"==t[0]&&(t=e[++n],a=170),r.push(t.charCodeAt()+a-33),t=e[++n]}return r},Platform=function(e,n,t){var r=this;r.x=e,r.y=n,r.width=t,r.collide=1,r.v=function(e){(e.xi()>r.x&&e.xi()<r.x+r.width||e.xf()>r.x&&e.xf()<r.x+r.width||e.xi()<r.x&&e.xf()>r.x+r.width)&&r.y>e.yil()&&r.y+5<e.yf()&&e.vy>=0?(r.collide=1,e.land(n)):r.collide=0},r.ag=function(){ctx.fillRect(r.x,r.y,r.width,5)}},Level=function(){var e=this;e.w=3500,e.h=0;var n=20;e.generateLevel=function(){platforms=[];for(var t=0;t<=e.w;t+=n){var r=t%(2*Math.PI),a=-10*Math.sin(r);e.h=a<e.h?a:e.h,platforms.push(new Platform(t,a,n))}},e.generateLevel(),e.ag=function(){var e=~~(-viewport.x/n);0>e&&(e=0);var t=e+~~(dimensions.w/n);for(t>=platforms.length&&(t=platforms.length-1),ctx.fillStyle="#A4A",i=e;t>=i;i++)platforms[i].ag()},e.v=function(e){var t=~~(e.xi()/n)-1;0>t&&(t=0);var r=~~(e.xf()/n)+1;for(r>=platforms.length&&(r=platforms.length-1),i=t;r>=i;i++)platforms[i].v(e)}},Power=function(e){var n=this;n.type=e,0==n.type&&(n.D=loadByString(fire)),1==n.type&&(n.D=loadByString(fire)),2==n.type&&(n.D=loadByString(fire)),3==n.type&&(n.D=loadByString(fire)),n.S=new Sprite(n.D),n.ai=0,n.ac=myhero.s,n.S.ac="hsl("+n.ac+",100%, 50%)",n.S.x=heroS.x+24,n.S.y=heroS.y,n.S.setPixelSize(2),n.S.vx=heroS.aa?10:-10,n.S.aa=heroS.aa,n.damage=1,n.v=function(){for(var e=enemies.length-1;e>=0;e--){var t=enemies[e].S;(t.xpi()>n.S.xpi()&&t.xpi()<n.S.xpf()||t.xpf()>n.S.xpi()&&t.xpf()<n.S.xpf())&&n.S.y>t.y&&n.S.y<t.yf()&&(enemies[e].hit(n.type,n.damage),n.del=1,createParticles(n.S,2,n.S.vx/2,-3,n.ac))}},n.d=function(){n.S.c(),n.S.dY(),n.ai=n.S.x>xlevel.w||n.S.x<-10},n.ah=function(){0==n.type&&n.S.u(),1==n.type&&n.S.u()}},Enemy=function(e,n){var t=this;t.S=n,t.ac=afColors[e],t.S.ac="hsl("+t.ac+",100%, 50%)",t.S.o("i"),t.S.setPixelSize(6),t.f=10,t.w=0,t.a=0,t.e=0,t.S.maxVx=.9*heroS.maxVx,t.S.x=300,t.skills=new ElementalSkill([e]),t.maxhp=9,t.S.hp=9,t.ghostTime=100,t.del=0,t.actionpipe="",t.setActionPipe=function(e){for(var n="",r=0;r<e.length;r++){var a=e[r],i=parseInt(e.substring(r+1,r+4));if(i){r+=(""+i).length;for(var o=0;i>o;o++)n+=a}else n+=a}t.actionpipe=n},t.setActionPipe("ljdw10jdstw10"),t.actionIndex=0,t.actions={f:t.S.forward,t:t.S.turn,j:t.S.ak,m:function(){},a:t.attack1,b:t.attack2,c:t.attack3,s:t.S.g,w:function(){},l:function(){t.S.p||t.actionIndex--},d:function(){t.S.p?t.S.g():(t.actionIndex--,t.S.forward())}},t.follow=function(){t.S.x<heroS.x?t.S.h():t.S.l()},t.away=function(){t.S.x<heroS.x&&t.S.x>0?t.S.l():t.S.x>heroS.x&&t.S.x+16*t.S.e<xlevel.w?t.S.h():t.S.g()},t.amAction=function(){var e=t.actionpipe[t.actionIndex];t.actions[e](),++t.actionIndex>=t.actionpipe.length&&(t.actionIndex=0)},t.d=function(){t.amAction(),t.S.d()},t.hit=function(e,n){t.S.hit(getTotalDamage(e,t.skills.current,n))&&!t.del&&(t.del=1,createParticles(t.S,n,0,0,t.ac),enemies.push(new Enemy(~~(4*Math.random()),new Sprite(loadByString(hero))))),currentEnemy=t,console.log(1-t.S.hp/t.maxhp,t.S.hp)},t.agAvatar=function(e,n){ctx.fillStyle=loop%16==0?"#fff":"red",ctx.fillRect(e-335,n+35,300,8),ctx.fillStyle="#000",ctx.fillRect(e-334,n+36,300*(1-t.S.hp/t.maxhp)-2,6)}},heroS=new Sprite(loadByString(hero));heroS.o("i");var HeroT=function(S){var m=this;m.S=S,m.S.setPixelSize(5),m.skills=new ElementalSkill([0,1,2,3],99),m.q=16,m.s=afColors[m.skills.current],m.S.ac="hsl("+m.s+",100%, 50%)",m.r=0,m.down=0,m.up=0,m.S.hp=30,m.maxhp=30,m.am=function(){++m.skills.current>3&&(m.skills.current=0),m.skills.dCurrentQ(),firexx.ac=basicColors[m.skills.current],m.r=5,keyMap-=64},m.prev=function(){--m.skills.current<0&&(m.skills.current=3),m.skills.dCurrentQ(),firexx.ac=basicColors[m.skills.current],keyMap-=16,m.r=-5},m.an=function(){if(m.q<=0){m.S.o("p");var e=0;m.down&&(e=7),m.up&&(e=-7),m.skills.an(e),m.q=16}m.S.ac="hsl("+m.s+","+m.skills.currentQ+"%, 50%)"},m.d=function(){m.S.d(),m.s+=m.r,m.s<0&&(m.s=355),m.s>355&&(m.s=5),m.s!=afColors[m.skills.current]?m.S.ac="hsl("+m.s+","+m.skills.currentQ+"%, 50%)":m.r=0,--m.q<0&&(m.q=0)},m.aj=function(){64&keyMap&&m.am(),16&keyMap&&m.prev(),m.down=8&keyMap?1:0,m.up=2&keyMap?1:0,128&keyMap&&(m.S.ak(),keyMap^=128),32&keyMap&&m.an(),1&keyMap&&m.S.x>-16?m.S.l():4&keyMap&&m.S.x+16*e<xlevel.w?m.S.h():m.S.g()},m.ag=function(){var vx=-viewport.x,vy=viewport.y;if(ctx.fillStyle="red",ctx.fillRect(vx+35,vy+35,300*(m.S.hp/m.maxhp),10),m.skills.ag(vx,vy+dimensions.h),currentEnemy)with(currentEnemy)agAvatar(vx+dimensions.w,vy),del&&0==--ghostTime&&(currentEnemy=null)}},xlevel=new Level,myhero=new HeroT(heroS),firexx=new Sprite(loadByString(fire));firexx.ac=basicColors[0],firexx.e=3,enemies.push(new Enemy(1,new Sprite(loadByString(hero))));var loop=0,yOld=myhero.S.y;ra(gameLoop)}();