!function(){function e(){o.fillStyle="#111",o.fillRect(0,0,800,600)}function t(){for(e(),E.drawCharacter(),b.drawCharacter(),b.accelerateY(.8),b.update(),X.update(),r=0;r<D.length;r++)D[r].draw(),D[r].collides();for(var n=z.length-1;n>=0;n--)z[n].updateX(),z[n].sprite.drawCharacter(),J%4==0&&z[n].sprite.rotate(),z[n].outside&&z.splice(n,1);J%8==0&&(E.rotate(),J=0),E.updateX(),X.manage(),J%2==0&&b.animate(),J++,requestAnimationFrame(t)}var n=document;n.get=n.getElementById;var r,i,a=n.get("c"),o=a.getContext("2d"),l=4,c=16,u=15,d=0,f={37:1,38:2,39:4,40:8,65:16,83:32,68:64,32:128};n.addEventListener("keydown",function(e){var t=e.keyCode?e.keyCode:e.which;f[t]&&(d|=f[t],e.preventDefault())}),n.addEventListener("keyup",function(e){var t=e.keyCode?e.keyCode:e.which;d&f[t]&&(d^=f[t],e.preventDefault())});var p="{f{g{h{i{u!$%056?@ABFORV`bcefostu~,",s='{H{I{X{Y"#$134ACEQSVacdsu~.~1~=~@~M~P~]~^~`~a',x='{I{J{Y{Z"#$134ACERSVcdsu~.~0~=~?~M~O~]~^~_~`',m='{Y{Z{i{j"#$134ACDESVWbcdqru~)~*~+~0~9~A~Q~a~b',y="{Z{[{g{h{i{j{k!#$134ACESTcesu~-~0~=~?~L~O~\\~_",v=["",'~A~>~0tqfUD2{i{h~@~=~1udVE1$#"{I{H',"B65VREA","~@~>tD2('&%{m{j{i~?~=udB651\"{J{I","~_~P~O~J~;~:~,tUB~b~a~Q~9~+~*~)uqWEA",'~`~M~?~>~=~/T2{k{[~P~J~A~;~:~0~,rdbVB1"{i{Y'],h={i:{kf:s,f:[0,0,0,0,0,0,0,0,0,1]},p:{kf:x,f:[2,3,3,2,0,-1]},r:{kf:m,f:[0,4,0,5,0,5,0,4,0]},j:{kf:y,f:[0]}},w=function(e){for(var t=new Int16Array(c),n=0;n<e.length;n++)t[e[n]>>4]|=1<<u-(15&e[n]);return t},A=function(e){var t=this;t.byteArray=new Int16Array(c),t.data=e,t.frames=[],t.iFrame=0,t.color="#000",t.x=0,t.y=0,t.vx=0,t.vy=0,t.downed=0,t.direction=1,t.landed=0,t.byteArray=w(t.data),t.maxVx=2.5*l,t.accelerationX=.5,t.pixelSize=l,t.rotate=function(){for(var e=[],n=0;c>n;n++)for(var r=0;c>r;r++)t.byteArray[n]&1<<u-r&&e.push(r*c+u-n);t.data=e,t.byteArray=w(e)},t.addFrame=function(e){t.frames.push(w(e)),t.iFrame=t.frames.length-1},t.fall=function(){t.y+=t.vy,t.vy<0&&(t.landed=0)},t.animate=function(){if(++t.iFrame>=t.frames.length&&(t.iFrame=0),"string"==typeof t.frames[t.iFrame])return t.setAnimation(t.frames[t.iFrame]);for(var e=[],n=0;c>n;n++){t.byteArray[n]=t.byteArray[n]^t.frames[t.iFrame][n];for(var r=0;c>r;r++)1<<u-r&t.byteArray[n]&&e.push(n*c+r)}t.data=e},t.xi=function(){return t.x+5*t.pixelSize},t.xf=function(){return t.x+11*t.pixelSize},t.yi=function(){return t.y+2*t.pixelSize},t.yil=function(){return t.y+12*t.pixelSize},t.yf=function(){return t.y+16*t.pixelSize},t.accelerateY=function(e){t.vy+=e,t.vy>3*t.pixelSize&&(t.vy=3*t.pixelSize)},t.land=function(e){t.landed||t.setAnimation("i"),t.vy=0,t.landed=1,t.canDoubleJump=1,t.downed=0,t.y=e-15*t.pixelSize},t.left=function(){t.vx-=t.accelerationX,t.landed&&t.setAnimation("r"),t.vx<-t.maxVx&&(t.vx=-t.maxVx),t.direction=0},t.right=function(){t.vx+=t.accelerationX,t.landed&&t.setAnimation("r"),t.vx>t.maxVx&&(t.vx=t.maxVx),t.direction=1},t.stopX=function(){0!=t.vx&&(t.vx=0,t.setAnimation("i"))},t.jump=function(){console.log(t.landed,t.canDoubleJump),(t.landed||t.canDoubleJump)&&(t.vy=3*-t.pixelSize,t.landed||(t.canDoubleJump=0),t.landed=0,t.setAnimation("j"))},t.down=function(){t.downed||(t.vy+=3*l-1,t.downed=1)},t.up=function(){},t.update=function(){t.fall(),t.x+=t.vx},t.updateX=function(){t.x+=t.vx},t.drawCharacter=function(){o.fillStyle=t.color;for(var e=0;e<t.data.length;e++){var n=15&t.data[e];o.fillRect(t.x+(t.direction?n:15-n)*t.pixelSize,t.y+(t.data[e]>>4)*t.pixelSize,t.pixelSize,t.pixelSize)}},t.setAnimation=function(e){if(t.currentAnimation!=e){t.currentAnimation=e,t.frames=[];var n=h[e].f;for(t.byteArray=w(C(h[e].kf)),i=0;i<n.length;i++){var r=v[n[i]];if(-1==n[i])return t.iFrame=t.frames.length,t.frames.push("i");t.addFrame(C(r))}}}},C=function(e){for(var t=0,n=e[t],r=[];n;){var i=85;"{"==n[0]&&(n=e[++t],i=0),"~"==n[0]&&(n=e[++t],i=170),r.push(n.charCodeAt()+i-33),n=e[++t]}return r},S=function(e,t,n){var r=this;r.x=e,r.y=t,r.width=n,r.collide=0,r.collides=function(){(b.xi()>r.x&&b.xi()<r.x+r.width||b.xf()>r.x&&b.xf()<r.x+r.width)&&r.y>b.yil()&&r.y+5<b.yf()&&b.vy>=0?(r.collide=1,b.land(t)):r.collide=0},r.draw=function(){o.fillStyle=r.collide?"#F00":"#66F",o.fillRect(r.x,r.y,r.width,5)}},g=C(s),b=new A(g),z=[];b.setAnimation("i");var F=[25,115,205,295],k=function(){var e=this;e.data=C(p),e.sprite=new A(e.data),e.outside=0,e.sprite.color=b.color,e.sprite.x=b.x+24,e.sprite.y=b.y,e.sprite.pixelSize=2,e.sprite.vx=b.direction?8:-8,e.sprite.direction=b.direction,e.updateX=function(){e.sprite.updateX(),e.outside=e.sprite.x>1e3||e.sprite.x<-10}},V=function(e){var t=this;t.sprite=e,t.element=0,t.coldown=16,t.currentColor=F[t.element],t.sprite.color="hsl("+t.currentColor+",100%, 50%)",t.incColor=0,t.next=function(){++t.element>3&&(t.element=0),t.incColor=5,d-=16},t.prev=function(){--t.element<0&&(t.element=3),d-=64,t.incColor=-5},t.power=function(){t.coldown<=0&&(t.sprite.setAnimation("p"),z.push(new k(0,2)),t.coldown=16)},t.update=function(){t.currentColor+=t.incColor,t.currentColor<0&&(t.currentColor=355),t.currentColor>355&&(t.currentColor=5),t.currentColor!=F[t.element]?t.sprite.color="hsl("+t.currentColor+",100%, 50%)":t.incColor=0,--t.coldown<0&&(t.coldown=0)},t.manage=function(){16&d&&t.next(),64&d&&t.prev(),8&d&&t.sprite.down(),2&d&&t.sprite.up(),128&d&&(t.sprite.jump(),d^=128),32&d&&t.power(),1&d?t.sprite.left():4&d?t.sprite.right():t.sprite.stopX()}};g=C(p);var E=new A(g);E.color="#E60";var X=new V(b),D=[];D.push(new S(12,400,240)),D.push(new S(600,400,240)),D.push(new S(320,336,240)),D.push(new S(120,520,60)),D.push(new S(150,500,240)),E.pixelSize=4,b.pixelSize=5;var J=0;requestAnimationFrame(t)}();