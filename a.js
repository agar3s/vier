window.doc=document,doc.get=doc.getElementById;var canvas=doc.get("c"),ctx=canvas.getContext("2d"),pixelSize=4,i,j,ppp=16,pp1=15,keyMap=0;keys={37:1,38:2,39:4,40:8,65:16,83:32,68:64,32:128},doc.addEventListener("keydown",function(e){var r=e.keyCode?e.keyCode:e.which;keys[r]&&(keyMap|=keys[r],e.preventDefault())}),doc.addEventListener("keyup",function(e){var r=e.keyCode?e.keyCode:e.which;keyMap&keys[r]&&(keyMap^=keys[r],e.preventDefault())}),window.fire="{f{g{h{i{u!$%056?@ABFORV`bcefostu~,",window.hero='{H{I{X{Y"#$134ACEQSVacdsu~.~1~=~@~M~P~]~^~`~a',heropower='{I{J{Y{Z"#$134ACERSVcdsu~.~0~=~?~M~O~]~^~_~`',herorun='{Y{Z{i{j"#$134ACDESVWbcdqru~)~*~+~0~9~A~Q~a~b',herojump="{Z{[{g{h{i{j{k!#$134ACESTcesu~-~0~=~?~L~O~\\~_",powerAnimation="",window.frames=["",'~A~>~0tqfUD2{i{h~@~=~1udVE1$#"{I{H',"B65VREA","~@~>tD2('&%{m{j{i~?~=udB651\"{J{I","~_~P~O~J~;~:~,tUB~b~a~Q~9~+~*~)uqWEA",'~`~M~?~>~=~/T2{k{[~P~J~A~;~:~0~,rdbVB1"{i{Y'],window.animations={i:{kf:window.hero,f:[0,0,0,0,0,0,0,0,0,1]},p:{kf:heropower,f:[2,3,3,2,0,-1]},r:{kf:herorun,f:[0,4,0,5,0,5,0,4,0]},j:{kf:herojump,f:[0]}};var convertTobyte=function(e){for(var r=new Int16Array(ppp),o=0;o<e.length;o++)r[e[o]>>4]|=1<<pp1-(15&e[o]);return r},Sprite=function(e){var r=this;r.byteArray=new Int16Array(ppp),r.data=e,r.frames=[],r.iFrame=0,r.color="#000",r.x=0,r.y=0,r.vx=0,r.vy=0,r.downed=0,r.direction=1,r.landed=0,r.byteArray=convertTobyte(r.data),r.maxVx=2.5*pixelSize,r.accelerationX=.5,r.pixelSize=pixelSize,r.rotate=function(){for(var e=[],o=0;ppp>o;o++)for(var t=0;ppp>t;t++)r.byteArray[o]&1<<pp1-t&&e.push(t*ppp+pp1-o);r.data=e,r.byteArray=convertTobyte(e)},r.addFrame=function(e){r.frames.push(convertTobyte(e)),r.iFrame=r.frames.length-1},r.fall=function(){r.y+=r.vy,r.vy<0&&(r.landed=0)},r.animate=function(){if(++r.iFrame>=r.frames.length&&(r.iFrame=0),"string"==typeof r.frames[r.iFrame])return r.setAnimation(r.frames[r.iFrame]);for(var e=[],o=0;ppp>o;o++){r.byteArray[o]=r.byteArray[o]^r.frames[r.iFrame][o];for(var t=0;ppp>t;t++)1<<pp1-t&r.byteArray[o]&&e.push(o*ppp+t)}r.data=e},r.xi=function(){return r.x+5*r.pixelSize},r.xf=function(){return r.x+11*r.pixelSize},r.yi=function(){return r.y+2*r.pixelSize},r.yil=function(){return r.y+12*r.pixelSize},r.yf=function(){return r.y+16*r.pixelSize},r.accelerateY=function(e){r.vy+=e,r.vy>3*r.pixelSize&&(r.vy=3*r.pixelSize)},r.land=function(e){r.landed||r.setAnimation("i"),r.vy=0,r.landed=1,r.canDoubleJump=1,r.downed=0,r.y=e-15*r.pixelSize},r.left=function(){r.vx-=r.accelerationX,r.landed&&r.setAnimation("r"),r.vx<-r.maxVx&&(r.vx=-r.maxVx),r.direction=0},r.right=function(){r.vx+=r.accelerationX,r.landed&&r.setAnimation("r"),r.vx>r.maxVx&&(r.vx=r.maxVx),r.direction=1},r.stopX=function(){0!=r.vx&&(r.vx=0,r.setAnimation("i"))},r.jump=function(){console.log(r.landed,r.canDoubleJump),(r.landed||r.canDoubleJump)&&(r.vy=3*-r.pixelSize,r.landed||(r.canDoubleJump=0),r.landed=0,r.setAnimation("j"))},r.down=function(){r.downed||(r.vy+=3*pixelSize-1,r.downed=1)},r.up=function(){},r.update=function(){r.fall(),r.x+=r.vx},r.updateX=function(){r.x+=r.vx},r.drawCharacter=function(){ctx.fillStyle=r.color;for(var e=0;e<r.data.length;e++){var o=15&r.data[e];ctx.fillRect(r.x+(r.direction?o:15-o)*r.pixelSize,r.y+(r.data[e]>>4)*r.pixelSize,r.pixelSize,r.pixelSize)}},r.setAnimation=function(e){if(r.currentAnimation!=e){r.currentAnimation=e,r.frames=[];var o=animations[e].f;for(r.byteArray=convertTobyte(loadByString(animations[e].kf)),j=0;j<o.length;j++){var t=frames[o[j]];if(-1==o[j])return r.iFrame=r.frames.length,r.frames.push("i");r.addFrame(loadByString(t))}}}},loadByString=function(e){for(var r=0,o=e[r],t=[];o;){var i=85;"{"==o[0]&&(o=e[++r],i=0),"~"==o[0]&&(o=e[++r],i=170),t.push(o.charCodeAt()+i-33),o=e[++r]}return t};Platform=function(e,r,o){var t=this;t.x=e,t.y=r,t.width=o,t.collide=0,t.collides=function(){(heroS.xi()>t.x&&heroS.xi()<t.x+t.width||heroS.xf()>t.x&&heroS.xf()<t.x+t.width)&&t.y>heroS.yil()&&t.y+5<heroS.yf()&&heroS.vy>=0?(t.collide=1,heroS.land(r)):t.collide=0},t.draw=function(){ctx.fillStyle=t.collide?"#F00":"#66F",ctx.fillRect(t.x,t.y,t.width,5)}},data=loadByString(hero),heroS=new Sprite(data),powers=[],heroS.setAnimation("i"),heroElementColors=[25,115,205,295],Power=function(){var e=this;e.data=loadByString(fire),e.sprite=new Sprite(e.data),e.outside=0,e.sprite.color=heroS.color,e.sprite.x=heroS.x+24,e.sprite.y=heroS.y,e.sprite.pixelSize=2,e.sprite.vx=heroS.direction?8:-8,e.sprite.direction=heroS.direction,e.updateX=function(){e.sprite.updateX(),e.outside=e.sprite.x>1e3||e.sprite.x<-10}},HeroT=function(e){var r=this;r.sprite=e,r.element=0,r.coldown=16,r.currentColor=heroElementColors[r.element],r.sprite.color="hsl("+r.currentColor+",100%, 50%)",r.incColor=0,r.next=function(){++r.element>3&&(r.element=0),r.incColor=5,keyMap-=16},r.prev=function(){--r.element<0&&(r.element=3),keyMap-=64,r.incColor=-5},r.power=function(){r.coldown<=0&&(r.sprite.setAnimation("p"),powers.push(new Power(0,2)),r.coldown=16)},r.update=function(){r.currentColor+=r.incColor,r.currentColor<0&&(r.currentColor=355),r.currentColor>355&&(r.currentColor=5),r.currentColor!=heroElementColors[r.element]?r.sprite.color="hsl("+r.currentColor+",100%, 50%)":r.incColor=0,--r.coldown<0&&(r.coldown=0)},r.manage=function(){16&keyMap&&r.next(),64&keyMap&&r.prev(),8&keyMap&&r.sprite.down(),2&keyMap&&r.sprite.up(),128&keyMap&&(r.sprite.jump(),keyMap^=128),32&keyMap&&r.power(),1&keyMap?r.sprite.left():4&keyMap?r.sprite.right():r.sprite.stopX()}},data=loadByString(fire),firexx=new Sprite(data),firexx.color="#E60",myhero=new HeroT(heroS);var cleanSpace=function(){ctx.fillStyle="#111",ctx.fillRect(0,0,800,600)},platforms=[];platforms.push(new Platform(12,400,240)),platforms.push(new Platform(600,400,240)),platforms.push(new Platform(320,336,240)),platforms.push(new Platform(120,520,60)),platforms.push(new Platform(150,500,240)),firexx.pixelSize=4,heroS.pixelSize=5;var loop=0,gameLoop=function(){for(cleanSpace(),firexx.drawCharacter(),heroS.drawCharacter(),heroS.accelerateY(.8),heroS.update(),myhero.update(),i=0;i<platforms.length;i++)platforms[i].draw(),platforms[i].collides();for(var e=powers.length-1;e>=0;e--)powers[e].updateX(),powers[e].sprite.drawCharacter(),loop%4==0&&powers[e].sprite.rotate(),powers[e].outside&&powers.splice(e,1);loop%8==0&&(firexx.rotate(),loop=0),firexx.updateX(),myhero.manage(),loop%2==0&&heroS.animate(),loop++,requestAnimationFrame(gameLoop)};requestAnimationFrame(gameLoop);