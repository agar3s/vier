!function(){function SfxrParams(){this.setSettings=function(e){for(var t=0;t<24;t++)this[String.fromCharCode(97+t)]=e[t]||0;this.c<.01&&(this.c=.01);var r=this.b+this.c+this.e;if(r<.18){var i=.18/r;this.b*=i,this.c*=i,this.e*=i}}}function SfxrSynth(){this._params=new SfxrParams;var e,t,r,i,o,n,s,a,l,c,m,x;this.reset=function(){var e=this._params;i=100/(e.f*e.f+.001),o=100/(e.g*e.g+.001),n=1-e.h*e.h*e.h*.01,s=-e.i*e.i*e.i*1e-6,e.a||(m=.5-e.n/2,x=5e-5*-e.o),a=1+e.l*e.l*(e.l>0?-.9:10),l=0,c=1==e.m?0:(1-e.m)*(1-e.m)*2e4+32},this.totalReset=function(){this.reset();var i=this._params;return e=i.b*i.b*1e5,t=i.c*i.c*1e5,r=i.e*i.e*1e5+12,3*((e+t+r)/3|0)},this.synthWave=function(f,p){var d=this._params,u=1!=d.s||d.v,h=d.v*d.v*.1,y=1+3e-4*d.w,v=d.s*d.s*d.s*.1,b=1+1e-4*d.t,A=1!=d.s,w=d.x*d.x,g=d.g,k=d.q||d.r,S=d.r*d.r*d.r*.2,E=d.q*d.q*(d.q<0?-1020:1020),M=d.p?((1-d.p)*(1-d.p)*2e4|0)+32:0,C=d.d,T=d.j/2,F=d.k*d.k*.01,B=d.a,z=e,R=1/e,P=1/t,j=1/r,L=5/(1+d.u*d.u*20)*(.01+v);L>.8&&(L=.8),L=1-L;for(var D,I,G,X,_,Y,W=!1,V=0,U=0,q=0,J=0,O=0,H=0,N=0,Q=0,$=0,Z=0,K=new Array(1024),ee=new Array(32),te=K.length;te--;)K[te]=0;for(var te=ee.length;te--;)ee[te]=2*Math.random()-1;for(var te=0;te<p;te++){if(W)return te;if(M&&++$>=M&&($=0,this.reset()),c&&++l>=c&&(c=0,i*=a),n+=s,i*=n,i>o&&(i=o,g>0&&(W=!0)),I=i,T>0&&(Z+=F,I*=1+Math.sin(Z)*T),I|=0,I<8&&(I=8),B||(m+=x,m<0?m=0:m>.5&&(m=.5)),++U>z)switch(U=0,++V){case 1:z=t;break;case 2:z=r}switch(V){case 0:q=U*R;break;case 1:q=1+2*(1-U*P)*C;break;case 2:q=1-U*j;break;case 3:q=0,W=!0}k&&(E+=S,G=0|E,G<0?G=-G:G>1023&&(G=1023)),u&&y&&(h*=y,h<1e-5?h=1e-5:h>.1&&(h=.1)),Y=0;for(var re=8;re--;){if(N++,N>=I&&(N%=I,3==B))for(var ie=ee.length;ie--;)ee[ie]=2*Math.random()-1;switch(B){case 0:_=N/I<m?.5:-.5;break;case 1:_=1-N/I*2;break;case 2:X=N/I,X=6.28318531*(X>.5?X-1:X),_=1.27323954*X+.405284735*X*X*(X<0?1:-1),_=.225*((_<0?-1:1)*_*_-_)+_;break;case 3:_=ee[Math.abs(32*N/I|0)]}u&&(D=H,v*=b,v<0?v=0:v>.1&&(v=.1),A?(O+=(_-H)*v,O*=L):(H=_,O=0),H+=O,J+=H-D,J*=1-h,_=J),k&&(K[Q%1024]=_,_+=K[(Q-G+1024)%1024],Q++),Y+=_}Y*=.125*q*w,f[te]=Y>=1?32767:Y<=-1?-32768:32767*Y|0}return p}}function setFont(e){ctx.font=e?"normal lighter 12px":"normal lighter 20px monospace"}function intersectRect(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)}function getShader(e,t){var r,i=doc.get("2d-"+t+"-shader").firstChild;return r="fragment"==t?e.createShader(e.FRAGMENT_SHADER):e.createShader(e.VERTEX_SHADER),e.shaderSource(r,i.textContent),e.compileShader(r),r}function getAudio(e){var t=new Audio;t.src=jsfxr(e),setTimeout(function(){t.play()},1)}function getTotalDamage(e,t,r){return elementalMatriz[e][t]*r/2}function Particle(e,t,r,i,o,n){var s=this;s.x=e,s.y=t,s.vx=r,s.vy=i,s.size=o,s.color=n,s.life=100,s.update=function(){return s.x+=s.vx,s.vy+=.2,s.y+=s.vy,s.size*=1,--s.life<0},s.draw=function(){ctx.fillStyle="hsla("+s.color+","+s.life+"%, "+s.life+"%, "+s.life/100+")",ctx.fillRect(s.x,s.y,s.size,s.size)}}function createParticles(e,t,r,i,o){for(var n=0;n<e.data.length;n++){var s=15&e.data[n];particles.push(new Particle(e.x+(e.direction?s:15-s)*e.pixelSize,e.y+(e.data[n]>>4)*e.pixelSize,((e.direction?s:15-s)-8)*t+r,((e.data[n]>>4)-8)*t+i-2,e.pixelSize,o))}}function randomParticles(){particles.push(new Particle(-viewport.x+1024*Math.random(),viewport.y+720*Math.random(),0,.1,2,360*Math.random()))}function createBooster(e,t,r,i){boosters.push(new Booster(e,t,r,i))}function restartLevel(e){var t=levels[currentLevel];enemies=[],powers=[],enemypowers=[],boosters=[],ctx.translate(-viewport.x,-e+viewport.y),viewport.x=0,viewport.y=e,heroS.reset(),myhero.reset(),currentEnemy=void 0,xlevel=LevelGenerator(t),xAxis=0,yAxis=0}function nextLevel(){currentLevel=levels[currentLevel].nextl,restartLevel(viewport.y)}function introScreen(vx,vy){ctx.fillStyle="rgba(0,0,0,0.1)",ctx.fillRect(vx,vy,1024,720),randomParticles(),ctx.fillStyle=basicColors[1],ctx.strokeStyle="hsl("+ ++hue%720+",50%,50%)",ctx.font="normal lighter 242px fantasy",ctx.strokeText("VIER",vx+512,vy+216),ctx.font="normal lighter 30px fantasy",ctx.lineWidth=1,ctx.strokeText("W i z a r d    W a r s",vx+512,vy+360),ctx.font="normal lighter 20px monospace",ctx.fillText("Press         to Start",vx+512,vy+432),ctx.fillText("made by @agar3s",vx+512,vy+648),ctx.fillStyle=loop%16==0?basicColors[1]:basicColors[0],ctx.fillText("      <Enter>         ",vx+512,vy+432);for(var i=particles.length-1;i>=0;i--)with(particles[i])draw(),update()&&particles.splice(i,1)}function pauseScreen(e,t){ctx.fillStyle="rgba(0,0,0,0.1)",ctx.fillRect(e,t,dimensions.w,720),ctx.fillStyle=white,setFont(0),ctx.ft("PAUSE",e+512,t+144),ctx.ft("Controls",e+512,t+216),ctx.ft("<S>: Shoot",e+.5*dimensions.w,t+288),ctx.ft("<- : move to left ",e+.2*dimensions.w,t+720*.48),ctx.ft("-> : move to right",e+.2*dimensions.w,t+381.6),ctx.ft("<space>   : jump       ",e+.5*dimensions.w,t+720*.48),ctx.ft("<space>2X : double jump",e+.5*dimensions.w,t+381.6),ctx.ft("<D> : next element    ",e+.8*dimensions.w,t+720*.48),ctx.ft("<A> : previous element",e+.8*dimensions.w,t+381.6),ctx.ft("Powers",e+512,t+453.6),ctx.ft("      beats      ",e+512,t+720*.7),ctx.ft("      beats     ",e+.7*dimensions.w,t+576),ctx.ft("     beats    ",e+512,t+648),ctx.ft("    beats      ",e+.3*dimensions.w,t+576),ctx.fillStyle=basicColors[1],ctx.ft("Water            ",e+512,t+720*.7),ctx.ft("          Water",e+.3*dimensions.w,t+576),ctx.fillStyle=basicColors[2],ctx.ft("Earth           ",e+.7*dimensions.w,t+576),ctx.ft("            Earth",e+512,t+720*.7),ctx.fillStyle=basicColors[3],ctx.ft("Fire          ",e+512,t+648),ctx.ft("            Fire",e+.7*dimensions.w,t+576),ctx.fillStyle=basicColors[0],ctx.fillText("Air            ",e+.3*dimensions.w,t+576),ctx.fillText("           Air",e+512,t+648)}function deadScreen(e,t){ctx.fillStyle="rgba(0,0,0,0.6)",ctx.fillRect(e,t,dimensions.w,720),ctx.fillStyle=white,setFont(0),ctx.fillText("DEAD",e+512,t+216),setFont(1),ctx.fillText("enter to restart level",e+512,t+360)}function gameLoop(){var wx=-viewport.x,wy=viewport.y;ctx.clearRect(wx,wy,dimensions.w,dimensions.h),xlevel.draw(wx,wy),heroS.accelerateY(.8),xlevel.collides(heroS),myhero.del||myhero.update(),xlevel.onPlayerX(heroS.x);for(var j=powers.length-1;j>=0;j--)with(powers[j])update(),sprite.draw(),loop%4==0&&animate(),loop%2==0&&collides(),(outside||del)&&powers.splice(j,1);for(var j=enemies.length-1;j>=0;j--)with(enemies[j]){if(del){enemies.splice(j,1),xlevel.onEnemyDied();continue}sprite.draw(),sprite.accelerateY(.8),xlevel.collides(sprite),update(),loop%2==0&&sprite.animate()}for(var j=enemypowers.length-1;j>=0;j--)with(enemypowers[j])update(),sprite.draw(),loop%4==0&&animate(),loop%2==0&&collidesHero(heroS.bounds()),(outside||del)&&enemypowers.splice(j,1);for(var i=particles.length-1;i>=0;i--)with(particles[i])draw(),update()&&particles.splice(i,1);for(var i=boosters.length-1;i>=0;i--)with(boosters[i])update(),xlevel.collides(sprite),sprite.draw(),loop%2==0&&collidesHero(heroS.bounds()),del&&boosters.splice(i,1);loop%8==0&&firexx.rotate(),firexx.updateX(),loop%2==0&&heroS.animate(),myhero.del?currentScreen="d":(heroS.draw(),myhero.manage(),myhero.draw(wx,wy)),myhero.sprite.x>450-wx&&myhero.sprite.x<xlevel.w-dimensions.w+450?(viewport.x-=myhero.sprite.vx,xxx=-myhero.sprite.vx):xxx=0,yyy=0,wy-viewport.oY<-dimensions.h&&myhero.sprite.y+viewport.oY+16*pixelSize>wy+dimensions.h&&myhero.sprite.vy>0?yyy=-myhero.sprite.vy:myhero.sprite.y-viewport.oY<viewport.y&&(myhero.sprite.vy<0?yyy=-myhero.sprite.vy:0==myhero.sprite.vy&&(yyy=yOld-myhero.sprite.y)),viewport.y-=yyy,yOld=myhero.sprite.y,ctx.translate(xxx,yyy),updateBackground(xxx)}function mainLoop(){with(showScreen[currentScreen](-viewport.x,viewport.y),256&keyMap&&(actionsScreen[currentScreen](1),keyMap-=256),loop%64==0&&(loop=0),loop++,gl)texImage2D(TEXTURE_2D,0,RGBA,RGBA,UNSIGNED_BYTE,canvitas),drawArrays(TRIANGLES,0,6);ra(mainLoop)}var synth=new SfxrSynth;window.jsfxr=function(e){synth._params.setSettings(e);var t=synth.totalReset(),r=new Uint8Array(4*((t+1)/2|0)+44),i=2*synth.synthWave(new Uint16Array(r.buffer,44),t),o=new Uint32Array(r.buffer,0,44);o[0]=1179011410,o[1]=i+36,o[2]=1163280727,o[3]=544501094,o[4]=16,o[5]=65537,o[6]=44100,o[7]=88200,o[8]=1048578,o[9]=1635017060,o[10]=i,i+=44;for(var n=0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a="data:audio/wav;base64,";n<i;n+=3){var l=r[n]<<16|r[n+1]<<8|r[n+2];a+=s[l>>18]+s[l>>12&63]+s[l>>6&63]+s[63&l]}return a};var doc=document;doc.get=doc.getElementById;var canvas=doc.get("c"),canvitas=canvas,ctx=canvas.getContext("2d"),pixelSize=4,i,j,ppp=16,pp1=15,dimensions={w:1024,h:720},viewport={x:0,y:-720,oY:250},black="#000",white="#fff",xlevel,xAxis=0,yAxis=0,currentLevel="level1",zoomFactor=(innerHeight-100)/dimensions.h;canvas.width=dimensions.w*zoomFactor,canvas.height=dimensions.h*zoomFactor,ctx.scale(zoomFactor,zoomFactor),ctx.translate(viewport.x,-viewport.y);var powers=[],enemypowers=[],elementColors=[55,205,115,25,99],basicColors=["yellow","#09F","#1F0","#F60","purple"],enemies=[],particles=[],platforms=[],boosters=[],currentEnemy=null,elementalNames=["Air","Water","Earth","Fire"];ctx.textBaseline="middle",ctx.textAlign="center",setFont();for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];requestAnimationFrame||(requestAnimationFrame=function(e){var t=(new Date).getTime(),r=Math.max(0,16-(t-lastTime)),i=setTimeout(function(){e(t+r)},r);return lastTime=t+r,i}),ra=requestAnimationFrame;var c3d=doc.get("canvas3d"),gl=c3d.getContext("webgl");with(gl.tp=gl.texParameteri,gl.ga=gl.getAttribLocation,gl.eva=gl.enableVertexAttribArray,gl.vap=gl.vertexAttribPointer,gl.AB=gl.ARRAY_BUFFER,gl){var s1=getShader(gl,"vertex"),s2=getShader(gl,"fragment"),p=createProgram();attachShader(p,s1),attachShader(p,s2),linkProgram(p),useProgram(p);var pl=ga(p,"ap"),tcl=ga(p,"at");bindBuffer(AB,createBuffer()),bufferData(AB,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),DYNAMIC_DRAW),eva(tcl),vap(tcl,2,FLOAT,!1,0,0);var txt=createTexture();bindTexture(TEXTURE_2D,txt),tp(TEXTURE_2D,TEXTURE_WRAP_S,CLAMP_TO_EDGE),tp(TEXTURE_2D,TEXTURE_WRAP_T,CLAMP_TO_EDGE),tp(TEXTURE_2D,TEXTURE_MIN_FILTER,NEAREST),uniform2f(getUniformLocation(p,"ur"),c3d.width,c3d.height),bindBuffer(AB,createBuffer()),eva(pl),vap(pl,2,FLOAT,!1,0,0),bufferData(AB,new Float32Array([0,0,c3d.width,0,0,c3d.height,0,c3d.height,c3d.width,0,c3d.width,c3d.height]),STATIC_DRAW)}var keyMap=0,keys={37:1,38:2,39:4,40:8,65:16,83:32,68:64,32:128,13:256};doc.addEventListener("keydown",function(e){var t=e.keyCode||e.which;keys[t]&&(keyMap|=keys[t],e.preventDefault())}),doc.addEventListener("keyup",function(e){var t=e.keyCode?e.keyCode:e.which;keyMap&keys[t]&&(keyMap^=keys[t],e.preventDefault())});for(var elementalMatriz=[[0,4,2,1],[1,0,4,2],[2,1,0,4],[4,2,1,0]],ElementalSkill=function(e,t){var r=this;r.elements=e,r.charges=[],r.locks=[0,0,0,0],r.current=r.elements[0],r.currentQ=t;for(var i=0;i<e.length;i++)r.charges.push(t);r.power=function(e,t,i){if(r.charges[r.current]-- >0){var o=new Power(r.current,2,1,t,i,heroS.direction?13:-13,e);powers.push(o),r.updateCurrentQ()}else r.charges[r.current]=0,r.updateCurrentQ()},r.lock=function(e){r.locks[e]=1},r.updateCurrentQ=function(){r.currentQ=r.charges[r.current]},r.nextElement=function(){r.current++,r.current>3&&(r.current=0)},r.draw=function(e,t){for(var i=0;i<4;i++)r.locks[i]||(ctx.fillStyle=i==r.current&&loop%8==0?"#000":basicColors[i],ctx.fillText(""+r.charges[i],e+40+(i%2==0?35:1==i?69:0),t-40-(i%2==1?30:0==i?60:0)));firexx.x=e+50,firexx.y=t-95,firexx.draw()}},ElementCell=function(e,t,r,i){},fire="{f{g{h{i{u!$%056?@ABFORV`bcefostu~,",hero='{H{I{X{Y"#$134ACEQSVacdsu~.~1~=~@~M~P~]~^~`~a',heropower='{I{J{Y{Z"#$134ACERSVcdsu~.~0~=~?~M~O~]~^~_~`',herorun='{Y{Z{i{j"#$134ACDESVWbcdqru~)~*~+~0~9~A~Q~a~b',herojump="{Z{[{g{h{i{j{k!#$134ACESTcesu~-~0~=~?~L~O~\\~_",booster="ABCDEQSUabcdequ~,~0~<~@~L~P~\\~]~^~_~`",powerAnimation="",frames=["",'~A~>~0tqfUD2{i{h~@~=~1udVE1$#"{I{H',"B65VREA","~@~>tD2('&%{m{j{i~?~=udB651\"{J{I","~_~P~O~J~;~:~,tUB~b~a~Q~9~+~*~)uqWEA",'~`~M~?~>~=~/T2{k{[~P~J~A~;~:~0~,rdbVB1"{i{Y',"~k~j~Lo_N>~i~Y~Im]M=.","~p~n~m~l~`~]~~P~M~=~0~$pi`YOG?92({m{g{^{U{N{J{E{9{4{%~t~s~k~j~b~[~Z~R~K~J~;~%njb^[NKA>;/+!{p{k{`{[{O{K{H{;{8{*","~o~_~O~N~?~>~#hXPA@8'{l{]{M~a~Q~L~A~<~$oi_ZYOJ?:*{o{_{N","~/~.~-uqecaTR","~?~>~=~0~,usqdb","~O~N~M~@~<~0~.~,tr","~`~_~^~]~P~O~N~M~b~a~Z~Y~R~Q~J~I~B~A~2~1","~^~N~>~.s{j{i{[{X~a~]~~Q~M~L~<~0~,uTR{J{I{;{8","~o~n~m~^~~O~M~>~=~.~-pF6{3~q~p~k~`~[~P~L~?~<~/~,soVG{U","~]~Na`5%{2~o~l~^~~O~M~.p_UF6{V","~Y~X~:~+X9(~k~j~i~h~$~#8","~d~c~B~1N-{s~t~s~r~q~@nm.",".{r2{u{d{c{b","{>{3{.{#","{Y{X{J{G{l{e{9{8{*{'","{{U","{9{8{*{'{Y{X{M{J{G{D","{>{3","{Y{X{J{G{-{${9{8{.{*{'{#","{<{5","{{U{9{8{*{'{Y{X{J{G","{l{e{M{D{<{5{-{$"],defaultAnimations={i:{kf:"",f:[0]}},heroAnimations={i:{kf:hero,f:[0,0,0,0,0,0,0,0,0,1]},p:{kf:heropower,f:[2,3,3,2,0,-1]},r:{kf:herorun,f:[0,4,0,5,0,5,0,4,0]},j:{kf:herojump,f:[0]}},convertTobyte=function(e){for(var t=new Int16Array(ppp),r=0;r<e.length;r++)t[e[r]>>4]|=1<<pp1-(15&e[r]);return t},loadByString=function(e){for(var t=0,r=e[t],i=[];r;){var o=85;"{"==r[0]&&(r=e[++t],o=0),"~"==r[0]&&(r=e[++t],o=170),i.push(r.charCodeAt()+o-33),r=e[++t]}return i},faceMask=loadByString("{%{&{'{({){*{+{,{5{6{7{8{9{:{;{<{E{F{G{H{I{J{K{L{U{V{W{X{Y{Z{[{\\{e{f{g{h{i{j{k{l{u!\"#$%&'"),Sprite=function(e,t){var r=this;r.byteArray=new Int16Array(ppp),r.data=loadByString(e),r.frames=[],r.iFrame=0,r.byteArray=convertTobyte(r.data),r.maxVx=2.2*pixelSize,r.accelerationX=.25,r.pixelSize=0,r.animations=t||defaultAnimations,r.hp=1,r.reset=function(){r.color=black,r.x=0,r.y=-720,r.vx=0,r.vy=0,r.direction=1,r.landed=0,r.canDoubleJump=0},r.reset(),r.setPixelSize=function(e){r.pixelSize=e,r.height=r.width=16*r.pixelSize},r.setPixelSize(pixelSize),r.generateFace=function(){for(var e=[],t=convertTobyte(r.data),i=convertTobyte(faceMask),o=0;o<ppp;o++)for(var n=t[o]&i[o],s=0;s<ppp;s++)1<<pp1-s&n&&e.push(o*ppp+s);r.faceSprite=e},r.generateFace(),r.rotate=function(){for(var e=[],t=0;t<ppp;t++)for(var i=0;i<ppp;i++)r.byteArray[t]&1<<pp1-i&&e.push(i*ppp+pp1-t);r.data=e,r.byteArray=convertTobyte(e)},r.addFrame=function(e){r.frames.push(convertTobyte(e)),r.iFrame=r.frames.length-1},r.fall=function(){r.y+=r.vy,r.vy<0&&(r.landed=0)},r.animate=function(){if(++r.iFrame>=r.frames.length&&(r.iFrame=0),"string"==typeof r.frames[r.iFrame])return r.setAnimation(r.frames[r.iFrame]);for(var e=[],t=0;t<ppp;t++){r.byteArray[t]=r.byteArray[t]^r.frames[r.iFrame][t];for(var i=0;i<ppp;i++)1<<pp1-i&r.byteArray[t]&&e.push(t*ppp+i)}r.data=e},r.xi=function(){return r.x+5*r.pixelSize},r.xpi=function(){return r.x+r.pixelSize},r.xf=function(){return r.x+11*r.pixelSize},r.xpf=function(){return r.x+14*r.pixelSize},r.yi=function(){return r.y+2*r.pixelSize},r.yil=function(){return r.y+12*r.pixelSize},r.yf=function(){return r.y+16*r.pixelSize},r.accelerateY=function(e){r.vy+=e,r.vy>3*r.pixelSize&&(r.vy=3*r.pixelSize)},r.land=function(e){r.landed||r.setAnimation("i"),r.vy=0,r.landed=1,r.canDoubleJump=1,r.downed=0,r.y=e-15*r.pixelSize},r.left=function(){r.vx>0&&(r.vx=0),r.vx-=r.accelerationX,r.landed&&r.setAnimation("r"),r.vx<-r.maxVx&&(r.vx=-r.maxVx),r.direction=0},r.right=function(){r.vx<0&&(r.vx=0),r.vx+=r.accelerationX,r.landed&&r.setAnimation("r"),r.vx>r.maxVx&&(r.vx=r.maxVx),r.direction=1},r.forward=function(){r.direction?r.x+17*pixelSize+r.vx<xlevel.w?r.right():r.stopX():r.x+r.vx>0?r.left():r.stopX()},r.turn=function(){r.direction=!r.direction},r.stopX=function(){0!=r.vx&&(r.vx=0,r.setAnimation("i"))},r.jump=function(){if(r.landed||r.canDoubleJump)return r.vy=3*-r.pixelSize,r.vy<-20&&(r.vy=-20),r.landed||(r.canDoubleJump=0),r.landed=0,r.setAnimation("j"),!0},r.update=function(){r.fall(),r.x+=r.vx},r.updateX=function(){r.x+=r.vx},r.updateY=function(){r.y+=r.vy},r.draw=function(){ctx.fillStyle=r.color;for(var e=0;e<r.data.length;e++){var t=15&r.data[e];ctx.fillRect(r.x+(r.direction?t:15-t)*r.pixelSize,r.y+(r.data[e]>>4)*r.pixelSize,r.pixelSize,r.pixelSize)}},r.drawFace=function(e,t){ctx.fillStyle=r.color;for(var i=0;i<r.faceSprite.length;i++){var o=15&r.faceSprite[i];ctx.fillRect(e+9*(r.direction?o:15-o),t+9*(r.faceSprite[i]>>4),9,9)}},r.setAnimation=function(e){if(r.currentAnimation!=e&&r.animations[e]){r.currentAnimation=e,r.frames=[];var t=r.animations[e].f;for(r.byteArray=convertTobyte(loadByString(r.animations[e].kf)),j=0;j<t.length;j++){var i=frames[t[j]];if(t[j]==-1)return r.iFrame=r.frames.length,r.frames.push("i");r.addFrame(loadByString(i))}}},r.hit=function(e){return r.hp-=e,r.hp<0&&(r.hp=0),0==r.hp},r.bounds=function(){return{left:r.xi(),right:r.xf(),top:r.yi(),bottom:r.yf()}}},Platform=function(e,t,r){var i=this;i.x=e,i.y=t,i.width=r,i.collide=1,i.collides=function(e){(e.xi()>i.x&&e.xi()<i.x+i.width||e.xf()>i.x&&e.xf()<i.x+i.width||e.xi()<i.x&&e.xf()>i.x+i.width)&&i.y>e.yil()&&i.y+5<e.yf()&&e.vy>=0?(i.collide=1,e.land(t)):i.collide=0},i.draw=function(){ctx.fillRect(i.x,i.y,i.width,5)}},Power=function(e,t,r,i,o,n,s){var a=this;a.type=e,a.data=fire,a.sprite=new Sprite(a.data),a.outside=0,a.color=elementColors[e],a.sprite.color=basicColors[e],a.sprite.x=i,a.sprite.y=o,a.sprite.setPixelSize(t),a.sprite.vx=n,a.sprite.vy=s,a.sprite.direction=n>0,a.damage=r,a.del=0,getAudio([e,.0066,.1909,.1663,.1679,.5182,,,-.1129,.2115,.6703,-.7826,-.1723,.2605,-9e-4,.3423,.0018,-.4875,.2872,-.0083,.1956,.7835,-.4082,.59]),a.collides=function(){for(var e=enemies.length-1;e>=0;e--){var t=enemies[e].sprite;intersectRect(t.bounds(),a.sprite.bounds())&&(enemies[e].hit(a.type,a.damage,a.sprite.direction),a.del=1,createParticles(a.sprite,2,a.sprite.vx/2,-3,a.color))}},a.collidesHero=function(e){intersectRect(e,a.sprite.bounds())&&(myhero.hit(a.type,a.damage,a.sprite.direction),a.del=1,createParticles(a.sprite,2,a.sprite.vx/2,-3,a.color))},a.update=function(){a.sprite.updateX(),a.sprite.updateY(),a.outside=a.sprite.x>xlevel.w||a.sprite.x<-10},a.animate=function(){a.sprite.rotate()}},Booster=function(e,t,r,i){var o=this;o.type=e,o.quantity=t,o.sprite=new Sprite(booster),o.color=elementColors[e],o.sprite.color=basicColors[e],o.sprite.x=r,o.sprite.y=i,o.sprite.vy=.5,o.sprite.landed=0,o.times=256,o.del=0,o.update=function(){var t=loop%32==0;o.sprite.landed?(o.del=0==o.times--,t=loop%~~(o.times/16)==0):o.sprite.updateY(),o.sprite.color=t?white:basicColors[e]},o.collidesHero=function(e){intersectRect(e,o.sprite.bounds())&&(myhero.charge(o.type,o.quantity),o.del=1,createParticles(o.sprite,0,0,-4,o.color))}},monster0="{'{({){*{7{8{9{:{G{H{I{J{W{X{Y{Z{e{f{g{h{i{j{u!\"#$%./2367>?BCFGHRSbcrs~-~.~/~0~1~2~=~>~?~@~A~B~I~J~K~L~Q~R~Y~Z~[~\\~a~b",monster1="{3{4{8{9{B{C{D{E{H{I{J{K{S{T{U{V{X{Y{[{\\{d{e{f{h{i{l{u!$%&'1267BCQRSTUabcflpqrst~\"~'~*~+~,~.~8~9~:~;~I~J",monster2="{&{'{({){*{5{6{7{8{:{;{F{G{H{K{O{V{W{X{Y{Z{[{_{`{h{i{j{k{n{o{p!\"#$%)*+./013567:;=ABCDEHIJKMSZ[]^abcdejmnqsu~%~-~.~/~;~<~@~A~I~J~K~Q~R~Y~Z~[~a~b~i~q~r~s~t",monster3='{4{5{6{7{8{G{H{I{U{V{W{X{Y{g{h"123@BCDGORUV_bors~,~/~<~?~L~P~[~`~k~l~p~q',monster4="",monster5="",boss1="{D{L{S{T{V{W{X{Y{Z{\\{]{c{d{e{f{g{h{i{j{k{l{m{t{u#&'0123456@ABCDEFQRSTUabcderst",boss4="{&{'{({){*{5{6{7{8{9{:{;{E{H{K{U{X{[{e{f{j{k{u!%&./012345678=ABCDEIMRSTY]^bcdhimnrst~#~$~,~-~.~/~0~;~<~@~A~J~K~Q~R~Z~[~a~b~h~i~j~k~q~r~s~t",boss5='{6{:{E{F{I{J{K{V{W{X{Y{Z{[{b{c{d{g{h{i{k{s{t{u#$%&/012345@ABCDEFGOQRSTUX_cdimostu~"~$~)~-~.~/~0~3~>~?~M~N~]',boss6="{'{*{4{7{8{9{:{={D{E{H{I{L{M{U{V{[{\\{e{f{g{h{i{j{k{l{s!\"#$%&).13469?@CDGHSTbcderu~,~-~0~1~<~A~K~L~Q~R~[~\\~a~b",elemental0='{8{;{H{I{J{K{Y{Z{g{k"#$%&123456@CEPRSTVW`bdru~,~0~<~?~L~M~O~P~Q~\\~]~_~`~a',superAggressive="lgajdag10jdsajd",monsterSprites={A0:monster0,A1:monster1,A2:monster2,A3:monster3,A4:boss1,A5:boss6,A6:hero,W0:monster0,W1:elemental0,W2:monster2,W3:monster3,W4:boss1,W5:hero,W6:hero,E0:monster0,E1:elemental0,E2:monster2,E3:monster3,E4:boss4,E5:hero,E6:hero,F0:monster0,F1:monster1,F2:monster2,F3:monster3,F4:boss1,F5:hero,F6:hero},monsterAnimations={B0:{i:{kf:monster0,f:[0,0,0,12,0,12]}},B1:heroAnimations,B2:{i:{kf:monster2,f:[0,6,7,8,8,7,6,0]}},B3:{i:{kf:monster3,f:[0,14,0,0,0,14]}},B4:{i:{kf:boss1,f:[9,0,10,11,0,0,11,10,9,0]}},B5:{i:{kf:boss6,f:[19,0,0,20,21,22,23,0,0,0,24,25,26,27,0,0,0]}},B6:heroAnimations},i=0;i<7;i++)monsterAnimations["A"+i]=monsterAnimations["B"+i],monsterAnimations["W"+i]=monsterAnimations["B"+i],monsterAnimations["E"+i]=monsterAnimations["B"+i],monsterAnimations["F"+i]=monsterAnimations["B"+i];monsterAnimations.A1={i:{kf:monster1,f:[0]}},monsterAnimations.F1=monsterAnimations.A1,monsterAnimations.E1={i:{kf:elemental0,f:[0,0,0,0,13]}},monsterAnimations.W1=monsterAnimations.E1,monsterAnimations.E4={i:{kf:boss4,f:[0,0,16,0,0,16,0,0,17,0,0,17]}},monsterAnimations.F4={i:{kf:boss5,f:[0,0,18]}},monsterAnimations.W4=monsterAnimations.F4;var monsterMoves={a:"ljlw90taw90",b:"lf80sw30asw30t",c:"lg60asw5aw5r20s",d:"ljdsw60ajdw30at",e:"ltja30w20",f:"ltg30a30w20",m:"w20hk20f9w9m20tas",n:"ljw20tg60stf30asw20",o:"lja10lf30jla10t",p:"w15hk30af15am30tw15am30af15k30at",q:"w15thk30af15am30tw15am30f15k30a",r:"ljda3jsw40hk20a5tf30sxa3"};monsterMoves.z=monsterMoves.m+"zx"+monsterMoves.e+"z"+monsterMoves.c+"z"+monsterMoves.d+"jw20z";var monsterAttributes={minion:"2020F0",elemental:"3042E2",monster:"3083C1",wizard:"406291",advanced:"304361",boss1:"308490",boss2:"416490",boss3:"425590",boss4:"330730",boss5:"420551",boss6:"750621",boss7:"820811"},monsterBook={a0:"00"+monsterAttributes.minion,a1:"01"+monsterAttributes.minion,a2:"02"+monsterAttributes.minion,a3:"03"+monsterAttributes.minion,b0:"10"+monsterAttributes.elemental,b1:"11"+monsterAttributes.elemental,b2:"12"+monsterAttributes.elemental,b3:"13"+monsterAttributes.elemental,c0:"20"+monsterAttributes.monster,c1:"21"+monsterAttributes.monster,c2:"22"+monsterAttributes.monster,c3:"23"+monsterAttributes.monster,d0:"30"+monsterAttributes.wizard,d1:"31"+monsterAttributes.wizard,d2:"32"+monsterAttributes.wizard,d3:"33"+monsterAttributes.wizard,e0:"10"+monsterAttributes.advanced,e1:"11"+monsterAttributes.advanced,e2:"12"+monsterAttributes.advanced,e3:"13"+monsterAttributes.advanced,f0:"20"+monsterAttributes.advanced,f1:"21"+monsterAttributes.advanced,f2:"22"+monsterAttributes.advanced,f3:"23"+monsterAttributes.advanced,x1:"23"+monsterAttributes.boss1,x2:"10"+monsterAttributes.boss2,x3:"40"+monsterAttributes.boss3,x4:"42"+monsterAttributes.boss4,x5:"41"+monsterAttributes.boss5,x6:"43"+monsterAttributes.boss5,x7:"50"+monsterAttributes.boss6,z1:"60"+monsterAttributes.boss7,z2:"61"+monsterAttributes.boss7,z3:"62"+monsterAttributes.boss7,z4:"63"+monsterAttributes.boss7},generateMonster=function(e,t,r){var i=e[0],o=e[1],n=parseInt(e[2],16),s=parseInt(e[3]+e[4],16),a=parseInt(e[5])+4,l=3*parseInt(e[6],16),c=e[7];return new Enemy(i,o,100*t,n,r,s,a,l,c)},monsterNames=["Minion","Elemental","Monster","Wizard","Master","Grand Master","Gran Elemental"],Enemy=function(e,t,r,i,o,n,s,a,l){var c=this;c.name=elementalNames[t]+" "+monsterNames[e],c.damage=parseInt(e)+1,c.color=elementColors[t],c.monsterCode=elementalNames[t][0]+e,c.sprite=new Sprite(monsterSprites[c.monsterCode],monsterAnimations[c.monsterCode]),c.sprite.color="hsl("+c.color+",100%, 50%)",c.sprite.setAnimation("i"),c.sprite.setPixelSize(s),c.sprite.maxVx=i||2.2*c.pixelSize,c.sprite.x=r,c.sprite.y=-720,c.skills=new ElementalSkill([t]),c.maxhp=n,c.sprite.hp=n,c.coldown=a,c.maxColdown=a,c.triggerType=l||2,c.ghostTime=100,c.del=0,c.setActionPipe=function(e){for(var t="",r=0;r<e.length;r++){var i=e[r],o=parseInt(e.substring(r+1,r+4));if(o){r+=(""+o).length;for(var n=0;n<o;n++)t+=i}else t+=i}c.actionpipe=t},c.setActionPipe(o||"f60taw20"),c.actionIndex=0,c.attack1=function(){if(c.coldown<=0){c.sprite.setAnimation("p");var e=-(c.sprite.x-heroS.x),t=-(c.sprite.y-heroS.y),r=Math.sqrt(e*e+t*t);e/=r,t/=r;var i=new Power(c.skills.current,c.sprite.pixelSize/3,c.damage,c.sprite.x+24,c.sprite.y,3*e,3*t);enemypowers.push(i),c.coldown=c.maxColdown}},c.follow=function(){c.sprite.direction=c.sprite.x<heroS.x,c.sprite.forward()},c.away=function(){c.sprite.direction=c.sprite.x>heroS.x,c.sprite.forward()},c.actions={f:c.sprite.forward,t:c.sprite.turn,j:c.sprite.jump,m:function(){},a:c.attack1,b:c.attack2,c:c.attack3,s:c.sprite.stopX,w:function(){},l:function(){c.sprite.landed||c.actionIndex--},d:function(){c.sprite.landed?c.sprite.stopX():(c.actionIndex--,c.sprite.forward())},g:c.follow,r:c.away,h:function(){c.sprite.fall=function(){}},x:function(){c.sprite.fall=function(){c.sprite.y+=c.sprite.vy,c.sprite.vy<0&&(c.sprite.landed=0)}},u:function(){c.sprite.y-=3},n:function(){c.sprite.y+=3},k:function(){c.actions.u(),c.sprite.forward()},m:function(){c.actions.n(),c.sprite.forward()},z:function(){c.skills.nextElement(),console.log("nx",c.skills.current),c.color=elementColors[c.skills.current],c.sprite.color="hsl("+c.color+",100%, 50%)"}},c.nextAction=function(){var e=c.actionpipe[c.actionIndex];c.actions[e](),++c.actionIndex>=c.actionpipe.length&&(c.actionIndex=0)},c.update=function(){c.nextAction(),c.sprite.update(),--c.coldown<0&&(c.coldown=0),c.sprite.y>400&&(c.del=1)},c.triggers=[function(){createBooster(c.skills.current,c.maxhp,c.sprite.x,c.sprite.y)},function(){createBooster(4,c.maxhp,c.sprite.x,c.sprite.y)},function(){0==~~(10*Math.random())?c.triggers[1]():c.triggers[0]()},function(){console.log("otra cosa")}],c.trigger=function(e){c.triggers[c.triggerType]()},c.hit=function(e,t,r){var i=getTotalDamage(e,c.skills.current,t);c.sprite.x+=(r?1:-1)*i*(10-c.damage),getAudio(0==i?[2,.09,.04,.19,.12,.13,.08,-.6065,-.82,.07,.85,,,,,.99,-1,-.86,1,.74,.09,.18,-1,.5]:[e,,.0949,,.2521,.4777,,-.6065,,,,,,,,,,,1,,,.216,,i/(2*t)]),c.sprite.hit(i)&&!c.del&&(c.del=1,createParticles(c.sprite,t,0,0,c.color),c.trigger("death"),getAudio([3,.09,.2099,.99,.5199,.62,.05,-.4199,-.2,,.1099,,,,,.5984,.5199,-.0849,1,,,,,.5])),currentEnemy=c},c.drawAvatar=function(e,t){ctx.fillStyle=white,ctx.fillText(c.name,e-120,t+20),ctx.fillStyle=loop%16==0?black:"yellow",ctx.fillRect(e-335,t+35,300,8),ctx.fillStyle="#300",ctx.fillRect(e-334,t+36,300*(1-c.sprite.hp/c.maxhp)-2,6),c.del&&loop%8!=0||c.sprite.drawFace(e-135,t+50)}},xf=0,yf=0,platformFunctions={a:function(e,t,r,i){return-t+yf},b:function(e,t,r,i){return-t+yf+r*(e-xf)},c:function(e,t,r,i){var o=(e/i-xf)%(2*Math.PI);return-t+yf+200*r*Math.cos(o)},d:function(e,t,r,i){var o=(e-xf)%(2*Math.PI);return-t+yf+200*r*Math.tan(o)},e:function(e,t,r,i){return-t+yf-r*(e-xf)},f:function(e,t,r,i){var o=(e-xf)%(2*Math.PI);return-t+yf+200*r*Math.sin(o*o)},g:function(e,t,r,i){return.005*platformFunctions.b(e,t,r,i)*platformFunctions.c(e,t,r,i)},h:function(e,t,r,i){return-t+yf+.005*r*(e-xf-650)*(e-xf-650)},i:function(e,t,r,i){return-t+yf+800+.005*r*(e-xf-400)*(e-xf-400)},v:function(e,t,r,i){return platformFunctions.a(e,t,r,i)*((e-xf)/i%3==0?1:1e3)},w:function(e,t,r,i){return platformFunctions.c(e,t,r,i)*((e-xf)/i%3==0?1:1e3)},x:function(e,t,r,i){return platformFunctions.c(e,t,r,i)*((e-xf)/i%2==1?1e3:1)}},Level=function(e,t,r,o,n,s,a){xf=0,yf=0;var l=this;l.w=e,l.h=0,l.title=s,l.enemiesVector=t,l.totalEnemies=l.enemiesVector.length,l.remainingEnemies=0,l.count=0,l.factor=r,l.generateLevel=function(e,t){var r=0,i=0,n=e[0];o=[];for(var s=0;s<=l.w;s+=l.factor){var a=platformFunctions[n](s,0,t,l.factor);l.h=a<l.h?a:l.h,o.push(new Platform(s,a,l.factor)),++r==e[i+1]&&(r-=e[i+1],i+=2,n=e[i],yf=a,xf=s)}},l.generateLevel(o,n),l.backG=a,l.draw=function(e,t){l.count++,a();var r=~~(e/l.factor);r<0&&(r=0);var n=r+1+~~(dimensions.w/l.factor);for(n>=o.length&&(n=o.length-1),ctx.fillStyle="#A4A",i=r;i<=n;i++)o[i].draw();ctx.fillStyle=white,ctx.fillText(l.remainingEnemies+"/"+l.totalEnemies,e+900,t+650)},l.onEnemyDied=function(){++l.remainingEnemies==l.totalEnemies&&setTimeout(nextLevel,2e3)},l.onPlayerX=function(e){if(!(l.count<60||0==l.enemiesVector.length)){var t=l.enemiesVector[0];e+dimensions.w-300>t.sprite.x&&(t.sprite.y=viewport.y,enemies.push(t),l.enemiesVector.splice(0,1))}},l.collides=function(e){var t=~~(e.xi()/l.factor)-1;t<0&&(t=0);var r=~~(e.xf()/l.factor)+1;for(r>=o.length&&(r=o.length-1),i=t;i<=r;i++)o[i].collides(e)}},LevelGenerator=function(e){for(var t=e.codeMonsters,r=e.plats,i=[],o=0;o<t.length;o++){var n=t[o],s=n[0]+n[1],a=n[2],l=parseInt(n.substring(3));i.push(generateMonster(monsterBook[s],l,monsterMoves[a]))}var c=myhero;return e.locks&&c.lock(e.locks),e.skill&&(c.selectSkill(e.skill),c.currentColor=elementColors[c.skills.current],c.sprite.color="hsl("+c.currentColor+",100%, 50%)"),new Level(e.width,i,e.factor,r,e.pendiente,e.title,e.backG)},snowBack=function(){randomParticles()},blackBack=function(){ctx.fillStyle="#002",ctx.fillRect(-viewport.x,yAxis+viewport.y,dimensions.w,dimensions.h),snowBack()},greenBack=function(){ctx.fillStyle="#121",ctx.fillRect(-viewport.x,yAxis+viewport.y,dimensions.w,dimensions.h),particles.push(new Particle(-viewport.x+1024*Math.random(),viewport.y+720*Math.random(),4,0,1,360*Math.random()))},blueBack=function(){ctx.fillStyle="#202",ctx.fillRect(-viewport.x,yAxis+viewport.y,dimensions.w,dimensions.h),particles.push(new Particle(-viewport.x+1024*Math.random(),viewport.y+720*Math.random(),9,(-10),2,30))},stormLoop=0,stormBack=function(){stormLoop++,ctx.fillStyle="#000",stormLoop%420!=0&&stormLoop%421!=0&&stormLoop%424!=0&&stormLoop%425!=0&&stormLoop%428!=0&&stormLoop%429!=0&&stormLoop%430!=0&&stormLoop%431!=0||(ctx.fillStyle="#555",stormLoop%420==0&&getAudio([3,.1135,.5,.6231,.6654,.0449,,.6264,-.6229,-.1508,.8529,-.5802,.874,.2927,.0184,.7343,-.2326,-.0537,.4766,.4925,.0156,.0633,-.8909,.4])),ctx.fillRect(-viewport.x,yAxis+viewport.y,dimensions.w,dimensions.h),particles.push(new Particle(-viewport.x+1024*Math.random(),viewport.y+720*Math.random(),0,0,2,180*Math.random()))},levels={level1:{codeMonsters:["a3b4","a3b9","a3b12","a3b15","a1b24","a1b27","a1b30","a1b35"],plats:["a",10,"b",20,"a",10,"b",7,"a",15,"w",15,"a",15,"b",15,"a",30],width:3700,factor:28,pendiente:-.1,title:"The Beginning",nextl:"boss1",locks:[0,2],skill:1,backG:function(){ctx.ft("      S         ",xAxis+200,yAxis-300),ctx.ft("       ->                ",xAxis+600,yAxis-200),ctx.ft("      SPACE        ",xAxis+1800,yAxis-300),ctx.ft("      D                  ",xAxis+2600,yAxis-220),ctx.ft("                    ALL        ",xAxis+3400,yAxis-320),ctx.fillStyle=white,ctx.ft("press   to shoot",xAxis+200,yAxis-300),ctx.ft("press     to move forward",xAxis+600,yAxis-200),ctx.ft("Press   to change element",xAxis+2600,yAxis-220),ctx.ft("press       to jump",xAxis+1800,yAxis-300),ctx.ft("You must to destroy     enemies",xAxis+3400,yAxis-320)}},boss1:{codeMonsters:["x1n4"],plats:["c",70],width:1024,factor:20,pendiente:-.05,title:"Fire Skeleton",nextl:"level2",locks:[0,2],skill:1,backG:function(){ctx.ft("            BOSS!",xAxis+400,yAxis-350),ctx.fillStyle=white,ctx.ft("Destroy the     ",xAxis+400,yAxis-350)}},level2:{codeMonsters:["a0b4","a2b9","a2b12","a0b15","a2b18","a0b27","a2c30","a0c35","a2c40","a0c45"],plats:["a",20,"b",15,"a",20,"b",15,"a",7,"v",21,"a",10,"b",22,"a",100],width:4800,factor:27,pendiente:-.3,title:"The Gate",nextl:"boss2",locks:[1,3],skill:2,backG:function(){ctx.ft("         VIER                                    ",xAxis+400,yAxis-350),ctx.ft("      D                                  ",xAxis+1600,yAxis-240),ctx.ft("      SPACE                                ",xAxis+2600,yAxis-380),ctx.ft("             charges                   ",xAxis+4200,yAxis-240),ctx.fillStyle=white,ctx.ft("With the      stone you can control the elements ",xAxis+400,yAxis-350),ctx.ft("Press   to change to the previous element",xAxis+1600,yAxis-240),ctx.ft("Press       two times to make a double jump",xAxis+2600,yAxis-380),ctx.ft("Enemies drop        for element energy",xAxis+4200,yAxis-240)}},boss2:{codeMonsters:["x2m4"],plats:["c",30],width:1024,factor:37,pendiente:-.05,title:"Fire Dragon",nextl:"level3",locks:[1,3],skill:2,backG:function(){ctx.ft("      up                flying        ",xAxis+400,yAxis-350),ctx.fillStyle=white,
ctx.ft("Press    arrow to shoot        enemies",xAxis+400,yAxis-350)}},level3:{codeMonsters:["b1b4","b1a9","b2a12","b2a15","b3m20","b3m25","b0m35","b0m40","c1a47","c2a55","b2a70","c3b80"],plats:["a",6,"f",6,"a",5,"b",5,"a",5,"b",5,"x",8,"c",9,"a",9],width:8400,factor:149,pendiente:-.5,title:"Air Palace",nextl:"boss3",backG:function(){ctx.ft("      Enter                  ",xAxis+7650,yAxis-1e3),ctx.ft("                          Masters!",xAxis+8650,yAxis-1100),ctx.fillStyle=white,ctx.ft("Elements are balanced",xAxis+400,yAxis-350),ctx.ft("    makes double damage to      ",xAxis+700,yAxis-250),ctx.ft("      makes double damage to      ",xAxis+1250,yAxis-350),ctx.ft("      makes double damage to     ",xAxis+1950,yAxis-200),ctx.ft("     makes double damage to    ",xAxis+3650,yAxis-300),ctx.ft("Press       to pause the game",xAxis+7650,yAxis-1e3),ctx.ft("I'm ready to destroy the         ",xAxis+8650,yAxis-1100),ctx.fillStyle=basicColors[0],ctx.ft("Air                             ",xAxis+700,yAxis-250),ctx.ft("                            Air",xAxis+3650,yAxis-300),ctx.fillStyle=basicColors[1],ctx.ft("                           Water",xAxis+700,yAxis-250),ctx.ft("Water                             ",xAxis+1250,yAxis-350),ctx.fillStyle=basicColors[2],ctx.ft("                             Earth",xAxis+1250,yAxis-350),ctx.ft("Earth                            ",xAxis+1950,yAxis-200),ctx.fillStyle=basicColors[3],ctx.ft("                             Fire",xAxis+1950,yAxis-200),ctx.ft("Fire                           ",xAxis+3650,yAxis-300)}},boss3:{codeMonsters:["x3m4"],plats:["c",2,"x",24,"c",2],width:1024,factor:50,pendiente:-.1,title:"Air Master",nextl:"level4",backG:blackBack},level4:{codeMonsters:["d3m4","d2m12","d2m20","d0m22","b2a28","b2a31","b2a32","b0m44","b3m50","a1c58","a3c60","a1c62","a3c64","c2b70","c2a75","d3d91","d1d95","d3d99"],plats:["a",4,"g",30,"a",15,"b",25,"a",15,"b",20,"w",18,"a",20,"e",20,"x",10,"d",20,"a",50,"v",18,"e",10,"a",20,"e",30,"a",49],width:10024,factor:27,pendiente:-.55,title:"Earth Palace",nextl:"boss4",backG:greenBack},boss4:{codeMonsters:["x4o4"],plats:["h",100],width:1350,factor:50,pendiente:-.01,title:"Earth Master",nextl:"level5",backG:greenBack},level5:{codeMonsters:["b1b4","e1e19","e3e24","f1b30","f3b32","d3m40","d1m44","d0m48","d2m56","e0a67","e3a70","e1a73"],plats:["a",4,"f",5,"v",9,"a",3,"b",3,"h",3,"e",3,"a",4,"v",6,"a",6],width:7650,factor:170,pendiente:-.5,title:"Water & Fire Montains",nextl:"boss5",backG:blueBack},boss5:{codeMonsters:["x5p5","x6q7"],plats:["b",14,"a",12,"e",14],width:1330,factor:35,pendiente:-.1,title:"Water & Fire Masters",nextl:"level6",backG:blueBack},level6:{codeMonsters:["b2a10","b2a12","b2a14","a0f25","a2f26","a2f27","a0f28","b1b38","b3e40","c0b68","c2b70","d1a106","d3m108","f0f110","f2f11","d3m113","d1a115"],plats:["a",60,"b",60,"a",60,"c",30,"a",60,"d",20,"a",60,"f",60,"a",60,"b",20,"i",30,"a",20,"v",60,"a",60,"v",33,"a",99],width:12e3,factor:16,pendiente:-.8,title:"Grand Master Palace",nextl:"boss6a",backG:stormBack},boss6a:{codeMonsters:["x7z4"],width:1200,plats:["a",2],factor:700,pendiente:1,title:"Grand Master",nextl:"boss6b",backG:stormBack},boss6b:{codeMonsters:["z1r6","z2r6","z3r6","z4r6"],width:1800,plats:["a",3],factor:700,pendiente:1,title:"Element's Avatar challenge",nextl:"ends",backG:stormBack},ends:{codeMonsters:[],width:1800,plats:["a",3],factor:700,pendiente:1,title:"Grand master mode",nextl:"ends",backG:function(){ctx.ft("Congratulations! you beat the Game!",xAxis+400,yAxis-350),ctx.ft("==Thanks for playing==",xAxis+600,yAxis-150),ctx.ft("made by @agar3s",xAxis+1400,yAxis-150),ctx.ft("      F5                        ",xAxis+1600,yAxis+150),ctx.fillStyle=white,ctx.ft("press    to start the game again",xAxis+1600,yAxis+150)}}},heroS=new Sprite(hero,heroAnimations);heroS.setAnimation("i");var HeroT=function(sprite){var m=this;m.sprite=sprite,m.sprite.setPixelSize(5),m.incColor=0,m.down=0,m.up=0,m.reset=function(){m.del=0,m.sprite.hp=31,m.maxhp=31,m.skills=new ElementalSkill([0,1,2,3],99),m.coldown=16,m.currentColor=elementColors[m.skills.current],m.sprite.color="hsl("+m.currentColor+",100%, 50%)"},m.reset(),m.lock=function(e){for(var t=0;t<e.length;t++)m.skills.lock(e[t])},m.nextSkill=function(e,t){return e+t>3?e=t-1:e+t<0?e=3+t+1:e+=t,m.skills.locks[e]?m.nextSkill(e,t):e},m.selectSkill=function(e){m.skills.current=e,m.skills.updateCurrentQ(),firexx.color=basicColors[m.skills.current]},m.next=function(){m.selectSkill(m.nextSkill(m.skills.current,1)),m.incColor=5,keyMap-=64},m.prev=function(){m.selectSkill(m.nextSkill(m.skills.current,-1)),keyMap-=16,m.incColor=-5},m.power=function(){if(m.coldown<=0){m.sprite.setAnimation("p");var e=0;m.down&&(e=7),m.up&&(e=-7),m.skills.power(e,heroS.x+24,heroS.y),m.coldown=16}m.sprite.color="hsl("+m.currentColor+","+m.skills.currentQ+"%, 50%)"},m.update=function(){m.sprite.update(),m.currentColor+=m.incColor,m.currentColor<0&&(m.currentColor=355),m.currentColor>355&&(m.currentColor=5),m.currentColor!=elementColors[m.skills.current]?m.sprite.color="hsl("+m.currentColor+","+m.skills.currentQ+"%, 50%)":m.incColor=0,--m.coldown<0&&(m.coldown=0),m.sprite.y>400&&(m.del=1)},m.manage=function(){64&keyMap&&m.next(),16&keyMap&&m.prev(),m.down=8&keyMap?1:0,m.up=2&keyMap?1:0,128&keyMap&&(m.sprite.jump()&&getAudio([0,,.2,,.1081,.3919,,.1669,,,,,,.361,,,,,1,,,,,.45]),keyMap^=128),32&keyMap&&m.power(),1&keyMap&&m.sprite.x>-16?m.sprite.left():4&keyMap&&m.sprite.x+16*pixelSize<xlevel.w?m.sprite.right():m.sprite.stopX()},m.hit=function(e,t,r){var i=getTotalDamage(e,m.skills.current,t);getAudio(0==i?[2,.09,.04,.19,.12,.13,.08,-.6065,-.82,.07,.85,,,,,.99,-1,-.86,1,.74,.09,.18,-1,.5]:[3,,.0949,,.2521,.4777,,-.6065,,,,,,,,,,,1,,,.216,,i/(2*t)-.25]),heroS.hit(i)&&!m.del&&(m.del=1,createParticles(heroS,t,0,0,m.color),getAudio([3,,.33,.87,.64,.2,.05,-.0799,.02,.78,.39,.06,,,,,,,1,,,,,.5]))},m.charge=function(e,t){4==e?(m.sprite.hp+=t,getAudio([0,,.2353,,.1763,.4972,,.4993,,,,,,.2177,,.4622,,,1,,,,,.55]),m.sprite.hp>m.maxhp&&(m.sprite.hp=m.maxhp)):(getAudio([0,.0199,.1299,.09,.4,.6,,.3719,,,,,,.4801*e/2,,.7578,,,1,,,,,.55]),m.skills.charges[e]+=t,m.skills.charges[e]>99&&(m.skills.charges[e]=99))},m.draw=function(vx,vy){with(ctx)fillStyle=white,fillText("Agtaske",vx+73,vy+20),strokeStyle="yellow",fillStyle="#300",strokeRect(vx+35,vy+35,300,8),fillRect(vx+35,vy+35,300,8),fillStyle="yellow",fillRect(vx+35,vy+35,300*(m.sprite.hp/m.maxhp),8),fillText("- "+xlevel.title+" -",vx+dimensions.w/2,vy+35);if(m.skills.draw(vx,vy+dimensions.h),currentEnemy)with(currentEnemy)drawAvatar(vx+dimensions.w,vy),del&&0==--ghostTime&&(currentEnemy=null);m.sprite.drawFace(vx-35,vy+50)}},hue=0;ctx.ft=ctx.fillText;var myhero=new HeroT(heroS),firexx=new Sprite(fire);firexx.color=basicColors[0],firexx.pixelSize=3;var loop=0,xcam=0,ycam=0,yOld=myhero.sprite.y,currentScreen="i",updateBackground=function(e){xAxis+=.1*e},showScreen={g:gameLoop,i:introScreen,p:pauseScreen,d:function(e,t){gameLoop(),deadScreen(e,t)}},actionsScreen={g:function(e){currentScreen="p"},i:function(e){restartLevel(-720),currentScreen="g"},p:function(e){currentScreen="g"},d:function(e){console.log("restart level"),restartLevel(-720),currentScreen="g"}};ra(mainLoop)}();